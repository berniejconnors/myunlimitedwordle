<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Unlimited Wordle</title>
  <style>
    :root{
      --bg:#121314;--fg:#e6e7e8;--muted:#9aa0a6;--tile:#1a1b1e;--tile-border:#3a3d42;
      --correct:#538d4e;--present:#b59f3b;--absent:#6b6f76;--accent:#6ea8fe;
      --warning:#d97706;--danger:#ef4444;--win:#16a34a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;display:flex;flex-direction:column;align-items:center}
    header{width:100%;max-width:700px;display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--tile-border)}
    h1{font-weight:800;letter-spacing:.02em;font-size:20px;margin:0}
    h1 span{color:var(--accent)}
    .controls{display:flex;gap:8px;align-items:center}
    button, .toggle{background:#1f2227;color:var(--fg);border:1px solid var(--tile-border);padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:600}
    button:hover{filter:brightness(1.2)}
    .toggle{display:flex;align-items:center;gap:6px}
    .toggle input{accent-color:var(--accent)}
    main{width:100%;max-width:700px;display:grid;grid-template-columns:1fr;gap:12px;padding:16px}

    /* Board */
    .board{display:grid;grid-template-rows:repeat(6,1fr);row-gap:3px;align-items:center;justify-items:center;margin:0 auto;width:min(100%,360px);aspect-ratio:5/6}
    .row{display:grid;grid-template-columns:repeat(5,1fr);gap:6px;width:100%}
    .tile{display:grid;place-items:center;border:2px solid var(--tile-border);background:var(--tile);font-weight:800;font-size:1.8rem;text-transform:uppercase;border-radius:8px}
    .tile.filled{border-color:#62666d}
    .tile.reveal{animation:flip .6s ease forwards}
    .tile.absent{background:var(--absent);border-color:var(--absent)}
    .tile.present{background:var(--present);border-color:var(--present)}
    .tile.correct{background:var(--correct);border-color:var(--correct)}
    @keyframes flip{0%{transform:rotateX(0)}50%{transform:rotateX(90deg)}100%{transform:rotateX(0)}}

    /* Keyboard */
    .keyboard{display:grid;gap:6px;margin:10px auto;width:min(100%,560px)}
    .kb-row{display:grid;grid-template-columns:repeat(20,1fr);gap:6px}
    .key{grid-column:span 2;background:#2a2d32;border:1px solid var(--tile-border);padding:12px 0;border-radius:8px;text-align:center;font-weight:700;text-transform:uppercase;user-select:none}
    .key.small{grid-column:span 2}
    .key.wide{grid-column:span 3}
    .key:hover{filter:brightness(1.15)}
    .key.correct{background:var(--correct);border-color:var(--correct)}
    .key.present{background:var(--present);border-color:var(--present)}
    .key.absent{background:var(--absent);border-color:var(--absent)}

    .msg{min-height:24px;text-align:center;color:var(--muted);font-weight:600}
    .toast{position:fixed;top:14px;left:50%;transform:translateX(-50%);background:#22252b;border:1px solid var(--tile-border);padding:10px 14px;border-radius:10px;color:var(--fg);font-weight:700;opaci[...] 
    .toast.show{opacity:1;animation:fade 1.8s ease}
    @keyframes fade{0%{opacity:0;transform:translate(-50%,-8px)}10%{opacity:1;transform:translate(-50%,0)}80%{opacity:1}100%{opacity:0}}

    .stats{display:flex;gap:14px;flex-wrap:wrap;justify-content:center;color:var(--muted)}
    .stat{background:#1c1f24;border:1px solid var(--tile-border);padding:8px 10px;border-radius:10px}

    footer{color:var(--muted);font-size:.9rem;margin-bottom:18px}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}

    @media (max-width:420px){
      .tile{font-size:1.4rem}
      .key{padding:10px 0}
    }
  </style>
</head>
<body>
  <header>
    <h1><span>Unlimited</span> Wordle</h1>
    <div class="controls">
      <label class="toggle" title="Hard mode: revealed hints must be used in later guesses">
        <input id="hardToggle" type="checkbox"/> Hard
      </label>
      <button id="newBtn" title="Start a new word">New Game</button>
      <button id="shareBtn" title="Copy your last board as emoji squares">Share</button>
    </div>
  </header>

  <main>
    <div class="board" id="board" aria-label="Guess grid"></div>
    <div class="msg" id="msg">Type a 5‑letter word.</div>
    <div class="keyboard" id="keyboard" aria-label="On‑screen keyboard"></div>
    <div class="stats" id="stats"></div>
  </main>

  <div class="toast" id="toast"></div>
  <footer>
    <p>Built for unlimited practice. Not affiliated with the NYT game.</p>
  </footer>
<script>
(function(){
// === DOM references ===
const boardEl = document.getElementById('board');
const keyboardEl = document.getElementById('keyboard');
const msgEl = document.getElementById('msg');
const statsEl = document.getElementById('stats');
const toastEl = document.getElementById('toast');

const shareBtn = document.getElementById('shareBtn');
const newBtn = document.getElementById('newBtn');

const hardToggle = document.getElementById('hardToggle');
const strictToggle = document.getElementById('strictToggle');
const superHardToggle = document.getElementById('superHardToggle');
const dailyToggle = document.getElementById('dailyToggle');

const ROWS = 6;
const COLS = 5;

let board = [];
let marks = [];
let kbState = {};
let row = 0;
let col = 0;
let solution = '';
let gameOver = false;
let lastResultSquares = '';

function toast(message, duration = 1600) {
  toastEl.textContent = message;
  toastEl.classList.remove('show');

  // force reflow so animation restarts
  void toastEl.offsetWidth;

  toastEl.classList.add('show');

  clearTimeout(toastEl._timer);
  toastEl._timer = setTimeout(() => {
    toastEl.classList.remove('show');
  }, duration);
}

function setMsg(text) {
  msgEl.textContent = text;
}
// === Stats helpers (per word length) ===
const LS_KEY = 'unlim_wordle_stats_v2';

function loadAllStats() {
  return JSON.parse(localStorage.getItem(LS_KEY) || '{}');
}

function saveAllStats(obj) {
  localStorage.setItem(LS_KEY, JSON.stringify(obj));
}

function loadStatsFor(len) {
  const all = loadAllStats();
  return all[len] || { played: 0, wins: 0, streak: 0, best: 0 };
}

function saveStatsFor(len, stats) {
  const all = loadAllStats();
  all[len] = stats;
  saveAllStats(all);
}

// === Embedded Wordle dictionaries (offline) ===

/* === Official Wordle Answers (2315) === */
const ANSWERS = ["cigar","rebut","sissy","humph","awake","blush","focal","evade","naval","serve","heath","dwarf","model","karma","stink","grade","quiet","bench","abate","feign","major","death","fresh"...];

/* === Allowed guesses (answers + extras) === */
const GUESSES = [
  ...ANSWERS,
  "aahed","aalii","aargh","aarti","abaca","abaci","abacs","abaft","abaka","abamp","aband","abash","abask","abaya","abbas","abbed","abbes","abcee","abeam","abear","abele","abers","abets","abies","abler"...
];

  function initGameState() {
  board = Array.from({ length: ROWS }, () => Array(COLS).fill(''));
  marks = Array.from({ length: ROWS }, () => Array(COLS).fill(''));
  kbState = {};
  row = 0;
  col = 0;
  gameOver = false;
  lastResultSquares = '';
}

  function pickWord(){
    const list = (ANSWERS && ANSWERS.length ? ANSWERS : SEED);
    if(dailyToggle && dailyToggle.checked){
      const ds = new Date();
      const y=ds.getFullYear(), m=ds.getMonth()+1, d=ds.getDate();
      const key = y + '-' + String(m).padStart(2,'0') + '-' + String(d).padStart(2,'0');
      let h=0; for(let i=0;i<key.length;i++){ h = (h*31 + key.charCodeAt(i)) >>> 0; }
      const idx = h % list.length;
      return list[idx];
    }
    return list[Math.floor(Math.random()*list.length)];
  }

  function reset(newWord=true){
    if(newWord){ solution = pickWord(); }
    row=0; col=0; gameOver=false;
    board = Array.from({length:ROWS},()=>Array(COLS).fill(''));
    marks = Array.from({length:ROWS},()=>Array(COLS).fill(''));
    kbState = {}; lastResultSquares='';
    renderBoard(); renderKeyboard(); renderStats();
    setMsg('Type a 5-letter word.');
  }

  // Build static board
  function renderBoard(){
    boardEl.innerHTML='';
    for(let r=0;r<ROWS;r++){
      const rowEl=document.createElement('div'); rowEl.className='row';
      for(let c=0;c<COLS;c++){
        const t=document.createElement('div'); t.className='tile';
        const ch=board[r][c]; if(ch) t.classList.add('filled'); t.textContent=ch;
        const m=marks[r][c]; if(m) t.classList.add(m);
        rowEl.appendChild(t);
      }
      boardEl.appendChild(rowEl);
    }
  }

  // Build keyboard layout
  const L1 = 'qwertyuiop'.split('');
  const L2 = 'asdfghjkl'.split('');
  const L3 = 'zxcvbnm'.split('');
  function renderKeyboard(){
    keyboardEl.innerHTML='';
    const rows=[L1,L2,L3];
    rows.forEach((letters,i)=>{
      const row=document.createElement('div'); row.className='kb-row';
      if(i===2){ addKey(row,'enter','Enter',3); }
      letters.forEach(l=> addKey(row,l,l,2));
      if(i===2){ addKey(row,'back','⌫',3); }
      keyboardEl.appendChild(row);
    });
    // apply coloring
    for(const [k,v] of Object.entries(kbState)){
      const el = keyboardEl.querySelector('[data-key="'+k+'"]');
      if(!el) continue; el.classList.remove('absent','present','correct'); el.classList.add(v);
    }
  }
function addKey(row, code, label, span){
  const b = document.createElement('div');
  b.className = 'key' + (span===3 ? ' wide' : ' small');
  b.textContent = label;
  b.dataset.key = code;
  // Removed: b.addEventListener('click',()=>handleKey(code));
  row.appendChild(b);
}
  function isValidGuess(word){
    const wordRe = new RegExp('^[a-z]{5}$');
    if(!wordRe.test(word)) return false;
    if (strictToggle && strictToggle.checked) {
      return Array.isArray(ANSWERS) && ANSWERS.includes(word);
    }
    return (Array.isArray(GUESSES) && GUESSES.includes(word)) ||
           (Array.isArray(ANSWERS) && ANSWERS.includes(word));
  }

  // Physical keyboard
  window.addEventListener('keydown', (e)=>{
    const k=e.key.toLowerCase();
    if(k==='enter'||k==='backspace'||(k.length===1 && k>='a' && k<='z')){
      e.preventDefault(); handleKey(k==='backspace'?'back':k);
    }
  });

  function handleKey(k){
    if(gameOver && k!=='enter'){ return; }
    if(k==='enter'){ submitRow(); return; }
    if(k==='back'){ if(col>0){ col--; board[row][col]=''; renderBoard(); } return; }
    if(k.length===1 && k>='a' && k<='z' && col<COLS){ board[row][col]=k; col++; renderBoard(); return; }
  }

  function submitRow(){
    if(col<COLS){ toast('Not enough letters'); return; }
    const guess = board[row].join('');

    // Guess dictionary rules
    if(!isValidGuess(guess)){
      toast('Not in word list');
      return;
    }

    // Hard mode constraints
    if(hardToggle && hardToggle.checked && row>0){
      const prev = marks[row-1];
      for(let i=0;i<COLS;i++){
        if(prev[i]==='correct' && guess[i]!==board[row-1][i]){ toast('Hard mode: keep green letters in place'); return; }
        if(prev[i]==='present' && !guess.includes(board[row-1][i])){ toast('Hard mode: include revealed yellow letters'); return; }
      }
    }

    // Super-hard constraints
    if(superHardToggle && superHardToggle.checked && row>0){
      // 1) Yellows must MOVE: any letter that was yellow at pos i previously cannot be placed at i again
      for(let r=0;r<row;r++){
        for(let i=0;i<COLS;i++){
          if(marks[r][i]==='present' && guess[i]===board[r][i]){
            toast('Super-hard: yellow letters must move');
            return;
          }
        }
      }
      // 2) No repeating gray letters (unless later upgraded)
      for(const ch of guess){
        if(kbState[ch]==='absent'){
          toast('Super-hard: gray letters are banned later');
          return;
        }
      }
    }

    scoreRow(guess);
  }

  function scoreRow(guess){
    const sol = solution;
    const res = Array(COLS).fill('absent');

    // Count letters in solution
    const counts={}; for(const ch of sol){ counts[ch]=(counts[ch]||0)+1; }

    // First pass: correct
    for(let i=0;i<COLS;i++){
      if(guess[i]===sol[i]){ res[i]='correct'; counts[guess[i]]--; }
    }
    // Second pass: present
    for(let i=0;i<COLS;i++){
      if(res[i]==='correct') continue;
      const ch=guess[i];
      if(counts[ch]>0){ res[i]='present'; counts[ch]--; }
    }

    // Write marks and animate
    marks[row]=res;
    revealRow(row);

    // Update keyboard best state (set gray on first sight, only upgrade after)
    for (let i = 0; i < COLS; i++) {
      const ch = guess[i];
      const order = { absent: 0, present: 1, correct: 2 };
      const prev = kbState[ch]; // leave undefined if unseen

      // If unseen, set whatever we have (including 'absent').
      // If seen, only upgrade (present > absent, correct > present).
      if (prev === undefined || order[res[i]] > order[prev]) {
        kbState[ch] = res[i];
      }
    }
    renderKeyboard();

    // Win/lose
    if(guess===sol){
      gameOver=true; setMsg('You got it in '+(row+1)+'/6! The word was "'+sol.toUpperCase()+'".');
      confetti();
      finalizeStats(true,row+1);
      lastResultSquares = buildShareSquares(marks, row);
      return;
    }
    if(row===ROWS-1){
      gameOver=true; setMsg('Out of tries. The word was "'+sol.toUpperCase()+'".');
      finalizeStats(false,ROWS);
      lastResultSquares = buildShareSquares(marks, row);
      return;
    }

    row++; col=0; setMsg('Keep going…');
  }

  function revealRow(r){
    const rowEl = boardEl.children[r];
    [...rowEl.children].forEach((tile,i)=>{
      setTimeout(()=>{
        tile.classList.add('reveal');
        tile.classList.add(marks[r][i]);
      }, i*220);
    });
  }

  function buildShareSquares(allMarks, uptoRow){
    const map={absent:'\u2B1B',present:'\uD83D\uDFE8',correct:'\uD83D\uDFE9'}; // black, yellow, green
    let out='';
    for(let r=0;r<=uptoRow;r++){
      out += allMarks[r].map(m=>map[m]||'\u2B1C').join('') + (r<uptoRow?'\n':'');
    }
    return out;
  }

  // Simple canvas confetti
  function confetti(){
    const c=document.createElement('canvas'); c.width=window.innerWidth; c.height=200; c.style.cssText='position:fixed;top:0;left:0;pointer-events:none;'; document.body.appendChild(c);
    const ctx=c.getContext('2d');
    const parts = Array.from({length:140},()=>({x:Math.random()*c.width,y:-20-Math.random()*200,vy:2+Math.random()*3,vx:(Math.random()-.5)*2,s:4+Math.random()*4,rot:Math.random()*6}));
    let t=0; const colors=['#538d4e','#b59f3b','#6ea8fe','#ffffff'];
    (function loop(){ t++; ctx.clearRect(0,0,c.width,c.height); parts.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; p.rot+=.1; ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot); ctx.fillStyle=colors[(p.s|0)%[...]
  }

  function finalizeStats(win,guesses){
    const s=loadStatsFor(COLS);
    s.played++; if(win){ s.wins++; s.streak++; if(s.streak>s.best) s.best=s.streak; } else { s.streak=0; }
    saveStatsFor(COLS,s); renderStats();
  }
  function renderStats(){
    const s=loadStatsFor(COLS);
    statsEl.innerHTML='';
    const mk=(label,val)=>{ const d=document.createElement('div'); d.className='stat'; d.innerHTML='<strong>'+val+'</strong><div style="font-size:.8rem;color:var(--muted)">'+label+'</div>'; return d; };
    const pct = s.played? Math.round((s.wins/s.played)*100) : 0;
    statsEl.append(mk('Length',COLS), mk('Played',s.played), mk('Wins',s.wins), mk('Win %',pct+'%'), mk('Streak',s.streak), mk('Best',s.best));
  }

  // Share button
  shareBtn.addEventListener('click',()=>{
    if(!lastResultSquares){ toast('Nothing to share yet'); return; }
    const modeBits = [
      hardToggle && hardToggle.checked ? 'H' : '',
      strictToggle && strictToggle.checked ? 'S' : '',
      superHardToggle && superHardToggle.checked ? 'X' : '',
      dailyToggle && dailyToggle.checked ? 'D' : ''
    ].filter(Boolean).join('');
    const text = 'Unlimited Wordle L'+COLS+(modeBits?'-'+modeBits:'')+' - '+new Date().toLocaleDateString()+'\n'+lastResultSquares;
    navigator.clipboard.writeText(text).then(()=>toast('Copied results to clipboard')).catch(()=>toast('Copy failed'));
  });

  // On-screen keyboard + toggle listeners
  keyboardEl.addEventListener('click',(e)=>{
    const k=e.target.closest('.key'); if(!k) return; const code=k.dataset.key; if(code) handleKey(code);
  });
  dailyToggle && dailyToggle.addEventListener('change',()=>{ reset(true); toast('Daily seed '+(dailyToggle.checked?'enabled':'disabled')); });
  strictToggle && strictToggle.addEventListener('change',()=>{ toast('Strict mode '+(strictToggle.checked?'on':'off')); });
  superHardToggle && superHardToggle.addEventListener('change',()=>{ toast('Super-hard '+(superHardToggle.checked?'on':'off')); });

  // Initialize: render UI first, then load lists, then pick word
  function init() {
  solution = pickWord();
  initGameState();        // ✅ THIS WAS MISSING
  renderBoard();
  renderKeyboard();
  renderStats?.();
  setMsg('Type a 5-letter word.');
  }
  init();
})();
</script>


</body>
</html>
